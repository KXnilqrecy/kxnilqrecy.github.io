<!doctype html>
<html>
  <head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E4NPYH1T62"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E4NPYH1T62');
</script>
    <meta charset="utf-8">
    <title>暦機能の更新</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://kxnilqrecy.github.io/assets/images/favicon.png">
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link type="application/atom+xml" rel="alternate" href="/feed.xml" />
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>暦機能の更新</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="暦機能の更新" />
<meta name="author" content="hasuma" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="　プログラミング担当の蓮間ひさとです。昨日(今朝)追加したばかりの暦表示機能ですが、なんかこぢんまりとして寂しかったので、いくつか表示する項目を増やしました。" />
<meta property="og:description" content="　プログラミング担当の蓮間ひさとです。昨日(今朝)追加したばかりの暦表示機能ですが、なんかこぢんまりとして寂しかったので、いくつか表示する項目を増やしました。" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-09-14T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="暦機能の更新" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"hasuma"},"dateModified":"2024-09-14T00:00:00+09:00","datePublished":"2024-09-14T00:00:00+09:00","description":"　プログラミング担当の蓮間ひさとです。昨日(今朝)追加したばかりの暦表示機能ですが、なんかこぢんまりとして寂しかったので、いくつか表示する項目を増やしました。","headline":"暦機能の更新","mainEntityOfPage":{"@type":"WebPage","@id":"/2024/09/14/%E6%9A%A6%E6%A9%9F%E8%83%BD%E3%81%AE%E6%9B%B4%E6%96%B0.html"},"url":"/2024/09/14/%E6%9A%A6%E6%A9%9F%E8%83%BD%E3%81%AE%E6%9B%B4%E6%96%B0.html"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="google-site-verification" content="1XS-_jxYV-ZnPNosmqWTDri7p8729Qo40Ylm4px0YWA" />
  </head>
  <body class="c7">
    <div class="clock" id="clock">
    ここに暦を表示
    <script>
        document.addEventListener('DOMContentLoaded', function() {
    fetch('https://kxnilqrecy.github.io/assets/csv/jungo.csv')
        .then(response => response.text())
        .then(data => parseCSV(data));
});
function digitSum(n){
     const nums = String(n).split('').map(Number);
     return nums.reduce((a, c) => a + c);
}
function parseCSV(data) {
    const jungos = data.split('\n');
    let nowdate = new Date();
    const epochdate = new Date(2019, 4, 1, 18);
    let deltadate = (nowdate.getTime() - epochdate.getTime()) / 1000 / 86400;
    let day = Math.floor(deltadate);
    let time = Math.floor((deltadate - day) * 96);
    let hisuinum = day + 5007;
    let nowjungo = jungos[day];
    let koyominum1 = ('000' + (hisuinum % 1000)).slice(-3);
    let hisui1 = ('00' + (hisuinum - (hisuinum % 1000)) / 1000).slice(-2);
    let hisui2 = ('00' + time).slice(-2);
    let cd = digitSum(String(koyominum1) + String(hisui1) + String(hisui2)) % 10;
    const lunarepoch = new Date(2019, 4, 5, 7, 45);
    let lunardelta = (nowdate.getTime() - lunarepoch.getTime()) / 1000 / 86400;
    let lp = Math.floor(lunardelta - Math.floor(lunardelta / 29.530582990) * 29.530582990);
    const xqepoch = new Date(2018, 8, 23, 10, 54);
    let xqdelta = (nowdate.getTime() - xqepoch.getTime()) / 1000 / 86400;
    let xq = Math.floor(Math.ceil(xqdelta / 365.242050827423) * 365.242050827423 - xqdelta);
    document.getElementById('clock').textContent = `Xq${xq}Lp${lp}/${nowjungo}:${koyominum1}-${cd}${hisui1}${hisui2}　`;
}
    </script>
</div>
    <h1>暦機能の更新</h1>

<p>
  14 Sep 2024
  
  
    - <a href="/authors/hasuma.html">蓮間ひさと</a>
  
</p>

<p>　プログラミング担当の蓮間ひさとです。昨日(今朝)追加したばかりの暦表示機能ですが、なんかこぢんまりとして寂しかったので、いくつか表示する項目を増やしました。</p>

<p>　おそらく右上にXq000Lp00/XX00:000-00000みたいな感じで記号と数字が並んでいると思いますが、スラッシュの右半分は<a href="./2024-09-14-カレンダー機能の追加.html">今朝のブログ</a>で紹介したときと変わっていません。旬号暦と名称未定の暦です。</p>

<p>　追加したのは左のXqとLpです。</p>

<p>　Xqは「次の秋分の日までの日数」です。厳密に言うと、秋分点通過きっかりのタイミングを計算している関係で同じ日に見ても違う数字になる可能性があります。あと、極めて簡略化した計算式を使っているので、そのうちズレるかもしれません。まぁグレゴリオ暦の秋分の日自体前後2日以下くらいしか変化しないので、そこまで極端に狂うことはないでしょう。たぶん。</p>

<p>　Lpは「大まかな月の満ち欠け」です。日本の旧暦とか、月齢とかと同じくらいの数値を取って、14が大体満月、0と28が大体新月です、が、これもいい加減な実装しかしていない+既存で使っている暦を使いまわした関係できっかり月の動きを計算しているわけではないです。</p>

<p>　以上です。カレンダー機能はこんな感じですが、他にも軽微なミスを修正しました。</p>

    <hr>
    <nav>
    <div class="center">サイトナビゲーション<br>
    
      <a href="/" >Home</a>
    
      <a href="/subcontents/blog.html" >「久入すいう」のブログ</a>
    
      <a href="/subcontents/pseudrences.html" >夢似科学研究所</a>
    
      <a href="/subcontents/tankas.html" >千翠れいしの短歌集</a>
    
      <a href="/subcontents/ytigeets.html" >ユーティゲート測候所</a>
    
      <a href="/subcontents/conlangs.html" >久入言語研究室</a>
    
      <a href="/subcontents/staff.html" >構成員</a>
    
      <a href="/about.html" >恵生ニルクレシィについて</a>
    
    </div>
</nav>
  </body>
</html>